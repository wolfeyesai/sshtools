# SSH 工具项目结构

本项目是一个Flutter应用，用于 SSH 设备管理和终端交互。使用Provider进行状态管理。以下是项目的文件结构和各个部分的功能说明。

## 目录结构

```
lib/
├── component/                 # UI组件 (通用)
│   ├── Animation_component.dart    # 动画组件
│   ├── background_component.dart   # 背景组件
│   ├── Button_component.dart       # 按钮组件
│   ├── card_select_component.dart  # 卡片选择组件 (旧功能，根据SSH工具需求判断是否保留)
│   ├── dropdown_component.dart     # 下拉菜单组件
│   ├── input_component.dart        # 输入框组件
│   ├── Log_component.dart          # 日志组件
│   ├── message_component.dart      # 消息提示和弹窗组件
│   ├── resource_label_component.dart # 资源标签组件 (可能与旧功能相关，根据SSH工具需求判断是否保留)
│   ├── Slider_component.dart       # 滑块组件
│   └── status_indicator_component.dart # 状态指示器组件
│
├── models/                    # 数据模型
│   ├── auth_model.dart            # 认证模型
│   ├── device_model.dart          # 设备模型 (核心模型)
│   ├── login_model.dart           # 登录模型
│   ├── resource_model.dart        # 资源模型 (旧功能，可能不再需要)
│   ├── settings_model.dart        # 设置模型 (核心模型)
│   ├── status_bar_model.dart      # 状态栏模型 (旧功能，可能不再需要)
│   ├── terminal_model.dart        # 终端模型 (核心模型)
│   ├── ui_config_model.dart       # UI配置模型
│   └── sidebar_model.dart         # 侧边栏模型 (旧功能，侧边栏已移除)
│
├── services/                  # 服务层
│   ├── auth_service.dart          # 认证服务
│   ├── server_service.dart        # 服务器通信服务 (旧功能，大部分功能已被ssh_service取代)
│   └── ssh_service.dart           # SSH通信服务 (核心服务)
│
├── controllers/               # 控制器
│   ├── device_controller.dart     # 设备控制器 (核心控制器)
│   ├── header_controller.dart     # 头部控制器
│   ├── home_controller.dart       # 主页控制器 (已调整)
│   ├── login_controller.dart      # 登录控制器
│   ├── register_controller.dart   # 注册控制器
│   ├── settings_controller.dart   # 设置控制器 (核心控制器)
│   └── terminal_controller.dart   # 终端控制器 (核心控制器)
│
├── utils/                     # 工具类
│   ├── blwebsocket.dart           # WebSocket通信工具 (旧功能，根据SSH工具需求判断是否保留)
│   ├── logger.dart                # 日志工具
│   └── ssh_client.dart            # SSH客户端实现 (核心工具)
│
├── views/                     # 视图/页面
│   ├── device_screen.dart         # 设备管理页面 (核心页面)
│   ├── header_screen.dart         # 页头组件
│   ├── home_screen.dart           # 主页 (已调整)
│   ├── layout_screen.dart         # 主布局页面 (包含页头、动态页中、底部导航栏)
│   ├── login_screen.dart          # 登录页面
│   ├── register_screen.dart       # 注册页面
│   ├── settings_screen.dart       # 设置页面 (核心页面)
│   ├── side_screen.dart           # 侧边栏页面 (旧功能，侧边栏已移除)
│   └── terminal_screen.dart       # 终端页面 (核心页面)
│
└── main.dart                  # 应用入口
```

## 主要组件说明

### 入口文件
- `main.dart`: 应用程序入口点，配置主题、路由和全局状态管理，通过Provider注册各种服务和模型。应用的根部现在通过路由控制初始页面。

### 主布局 (`layout_screen.dart`)
- `layout_screen.dart`: 负责应用的主要视觉结构。它包含一个固定的页头 (`HeaderScreen`)，一个根据底部导航栏选择动态切换显示的中心内容区域，以及一个底部导航栏 (`BottomNavigationBar`) 用于在"设备"、"终端"和"设置"页面之间导航。它协调这些部分的显示，但不包含具体页面的业务逻辑和数据。

### 页头 (`header_screen.dart`)
- `header_screen.dart`: 实现应用的顶部页头，包含用户头像、用户名、状态、刷新按钮和退出登录按钮。它通过Provider与 `HeaderController` 和相关模型交互。

### 数据模型结构 (`models/`)
数据模型采用Provider模式，存放在`models/`目录：
- `auth_model.dart`: 认证模型，管理用户认证状态。
- `device_model.dart`: 设备模型，管理SSH设备列表和连接信息。(核心模型)
- `terminal_model.dart`: 终端模型，管理终端会话状态、输出和输入缓冲区。(核心模型)
- `settings_model.dart`: 设置模型，管理SSH工具的各种配置项。(核心模型)
- `login_model.dart`: 登录模型，处理用户登录信息。
- `ui_config_model.dart`: UI配置模型，管理UI相关的设置。
- `resource_model.dart`: 资源模型 (旧功能，可能不再需要)。
- `status_bar_model.dart`: 状态栏模型 (旧功能，可能不再需要)。
- `sidebar_model.dart`: 侧边栏模型 (旧功能，侧边栏已移除)。

### 服务层 (`services/`)
服务层提供与外部系统交互的功能，与UI解耦：
- `auth_service.dart`: 提供认证相关功能，包括登录、注册、令牌管理等。
- `ssh_service.dart`: 提供SSH连接、命令执行、文件传输等核心SSH功能。它是SSH客户端工具 (`ssh_client.dart`) 的抽象和封装，供控制器调用。(核心服务)
- `server_service.dart`: 服务器通信服务 (旧功能，大部分功能已被 `ssh_service.dart` 取代，可能需要清理或重构)。

### 组件 (`component/`)
该目录包含可重用的UI组件，如按钮、输入框、滑块等。根据SSH工具的需求，可能需要新增或调整部分组件：
- `Animation_component.dart`: 动画组件。
- `background_component.dart`: 背景组件。
- `Button_component.dart`: 按钮组件。
- `card_select_component.dart`: 卡片选择组件 (旧功能，根据SSH工具需求判断是否保留)。
- `dropdown_component.dart`: 下拉菜单组件。
- `input_component.dart`: 输入框组件。
- `Log_component.dart`: 日志组件。
- `message_component.dart`: 消息提示和弹窗组件。
- `resource_label_component.dart`: 资源标签组件 (可能与旧功能相关，根据SSH工具需求判断是否保留)。
- `Slider_component.dart`: 滑块控制组件。
- `status_indicator_component.dart`: 状态指示器组件。

### 控制器 (`controllers/`)
控制器处理业务逻辑并连接视图与模型/服务：
- `device_controller.dart`: 处理设备列表的加载、添加、编辑、删除和连接等逻辑。与 `DeviceModel` 和 `ssh_service.dart` 交互。(核心控制器)
- `header_controller.dart`: 管理应用头部导航栏相关的逻辑和交互。
- `home_controller.dart`: 主页控制器 (已调整，与简化的主页视图对应)。
- `login_controller.dart`: 处理登录逻辑。
- `register_controller.dart`: 处理注册逻辑。
- `settings_controller.dart`: 处理设置项的读取、保存和应用等逻辑。与 `SettingsModel` 交互。(核心控制器)
- `terminal_controller.dart`: 管理终端会话的创建、命令发送、接收输出和断开连接等逻辑。与 `TerminalModel` 和 `ssh_service.dart` 交互。(核心控制器)

### 工具 (`utils/`)
- `blwebsocket.dart`: WebSocket通信工具 (旧功能，根据SSH工具需求判断是否保留或调整)。
- `logger.dart`: 日志记录工具。
- `ssh_client.dart`: 底层SSH客户端实现，负责建立和维护SSH连接、发送命令和接收原始数据。它是 `ssh_service.dart` 依赖的具体工具。(核心工具)

### 视图 (`views/`)
包含所有应用程序的页面和屏幕：
- `device_screen.dart`: **设备管理页面，由 `DeviceController` 提供数据，显示设备列表、添加/编辑设备界面等。(核心页面)**
- `header_screen.dart`: **页头组件的视图实现。**
- `home_screen.dart`: 主页 (已调整，显示IP和最近连接，不再作为主入口，但仍保留)。
- `layout_screen.dart`: **主布局页面，负责整体框架，包含页头、动态页中、底部导航栏。**
- `login_screen.dart`: 登录页面。
- `register_screen.dart`: 注册页面。
- `settings_screen.dart`: **设置页面，由 `SettingsController` 提供数据，显示配置选项。(核心页面)**
- `side_screen.dart`: 侧边栏页面 (旧功能，侧边栏已移除)。
- `terminal_screen.dart`: **终端页面，由 `TerminalController` 提供数据，显示终端输出和命令输入界面。(核心页面)**

## 状态管理方案

项目采用Provider作为状态管理解决方案：
1. 所有模型和服务均在`main.dart`中以Provider方式注册。
2. 视图通过Context获取服务和模型，避免使用全局变量。
3. 多级状态更新通过ChangeNotifier机制实现。
4. 使用ChangeNotifierProxyProvider实现依赖模型之间的联动更新。

## 项目架构模式

项目采用MVVM架构模式：前端是Flutter应用，后端使用 C++ 实现，数据存储使用 MySQL 8.0 数据库。
1. Model (模型层): 位于`models/`目录，负责数据存储和业务规则 (SSH核心模型已新增)。
2. ViewModel (控制器层): 位于`controllers/`目录，处理业务逻辑和状态管理，与Service层交互 (SSH核心控制器已新增)。
3. View (视图层): 位于`views/`目录，负责UI渲染，通过Provider观察模型变化并与控制器交互。**`layout_screen.dart` 作为顶层视图协调页头 (`header_screen.dart`)、动态内容视图 (`device_screen.dart`, `terminal_screen.dart`, `settings_screen.dart`) 和底部导航栏。**
4. Service (服务层): 位于`services/`目录，提供与外部系统（C++ 后端）的接入 (SSH核心服务 `ssh_service.dart` 已在计划中)。

## 应用流程

1. 应用启动后检查登录状态。
2. 如果已登录且状态有效，导航到 **`MainLayout` (主布局)**。
3. 否则导航到登录页面。
4. 登录成功后，导航到 **`MainLayout`**。
5. 在 **`MainLayout`** 中，用户可以使用底部导航栏在设备、终端和设置页面之间切换。
6. 各个页面通过对应的控制器和模型管理其状态和业务逻辑。

## 文件规模分析

文件规模将根据新功能的实现而变化。新的SSH相关模型、视图和控制器将取代旧的与游戏配置相关的文件。通用组件和服务将根据新需求进行调整。 