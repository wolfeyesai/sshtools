# BlWeb 项目结构

本项目是一个Flutter应用，用于游戏配置管理。使用Provider进行状态管理。以下是项目的文件结构和各个部分的功能说明。

## 目录结构

```
lib/
├── component/                 # UI组件
│   ├── Animation_component.dart    # 动画组件
│   ├── background_component.dart   # 背景组件
│   ├── Button_component.dart       # 按钮组件
│   ├── card_select_component.dart  # 卡片选择组件
│   ├── dropdown_component.dart     # 下拉菜单组件
│   ├── input_component.dart        # 输入框组件
│   ├── Log_component.dart          # 日志组件
│   ├── message_component.dart      # 消息组件
│   ├── resource_label_component.dart # 资源标签组件
│   ├── Slider_component.dart       # 滑块组件
│   └── status_indicator_component.dart # 状态指示器组件
│
├── models/                    # 数据模型
│   ├── aim_model.dart             # 瞄准模型
│   ├── app_settings_model.dart    # 应用设置模型
│   ├── auth_model.dart            # 认证模型
│   ├── data_collection_model.dart # 数据采集模型
│   ├── fire_model.dart            # 开火模型
│   ├── fov_model.dart             # 视野模型
│   ├── function_model.dart        # 功能配置模型
│   ├── game_icon_paths.dart       # 游戏图标路径常量
│   ├── game_model.dart            # 游戏模型
│   ├── login_model.dart           # 登录模型
│   ├── pid_model.dart             # PID控制模型
│   ├── resource_model.dart        # 资源模型
│   ├── sidebar_model.dart         # 侧边栏模型
│   ├── status_bar_model.dart      # 状态栏模型
│   └── ui_config_model.dart       # UI配置模型
│
├── services/                  # 服务层
│   ├── auth_service.dart          # 认证服务
│   └── server_service.dart        # 服务器通信服务
│
├── controllers/               # 控制器
│   ├── aim_controller.dart        # 瞄准控制器
│   ├── data_collection_controller.dart # 数据采集控制器
│   ├── fire_controller.dart       # 开火控制器
│   ├── fov_controller.dart        # 视野控制器
│   ├── function_controller.dart   # 功能控制器
│   ├── header_controller.dart     # 头部控制器
│   ├── home_controller.dart       # 首页控制器
│   ├── login_controller.dart      # 登录控制器
│   ├── pid_controller.dart        # PID控制器
│   ├── register_controller.dart   # 注册控制器
│   └── side_controller.dart       # 侧边栏控制器
│
├── utils/                     # 工具类
│   ├── blwebsocket.dart           # WebSocket通信工具
│   └── logger.dart                # 日志工具
│
├── views/                     # 视图/页面
│   ├── function/                  # 功能相关视图
│   │   ├── card_manager_component.dart # 卡片管理组件
│   │   └── function_screen.dart        # 功能屏幕
│   │
│   ├── aim_screen.dart            # 瞄准设置页面
│   ├── data_collection_screen.dart # 数据采集页面
│   ├── fire_screen.dart           # 开火设置页面
│   ├── fov_screen.dart            # 视野设置页面
│   ├── header_screen.dart         # 头部导航页面
│   ├── home_screen.dart           # 首页
│   ├── layout_screen.dart         # 布局页面
│   ├── login_screen.dart          # 登录页面
│   ├── pid_screen.dart            # PID设置页面
│   ├── register_screen.dart       # 注册页面
│   └── side_screen.dart           # 侧边栏页面
│
└── main.dart                  # 应用入口
```

## 主要组件说明

### 入口文件
- `main.dart`: 应用程序入口点，配置主题、路由和全局状态管理，通过Provider注册各种服务和模型

### 数据模型结构
数据模型采用Provider模式，存放在`models/`目录：
- `aim_model.dart`: 瞄准设置模型，管理瞄准相关参数
- `function_model.dart`: 功能配置模型，管理功能页面所需的数据，如预设配置、热键列表等
- `auth_model.dart`: 认证模型，管理用户认证状态
- `game_model.dart`: 游戏模型，管理当前选择的游戏和相关配置
- `login_model.dart`: 登录模型，处理用户登录信息
- `fov_model.dart`: 视野模型，管理FOV相关配置
- `data_collection_model.dart`: 数据采集模型，管理数据采集参数
- `fire_model.dart`: 开火模型，管理射击相关配置
- `pid_model.dart`: PID控制模型，管理PID参数
- `status_bar_model.dart`: 状态栏模型，管理应用状态栏数据
- `sidebar_model.dart`: 侧边栏模型，管理侧边栏状态和配置

### 服务层 (services/)
服务层提供与外部系统交互的功能，与UI解耦：
- `server_service.dart`: 处理与服务器的WebSocket通信，包括连接管理、消息发送接收等
- `auth_service.dart`: 提供认证相关功能，包括登录、注册、令牌管理等

### 组件 (component/)
该目录包含可重用的UI组件，如按钮、输入框、滑块等：
- `dropdown_component.dart`: 提供IconDropdown等下拉菜单组件，支持图标和文本显示
- `Button_component.dart`: 各种自定义按钮组件
- `message_component.dart`: 消息提示和弹窗组件
- `Animation_component.dart`: 动画效果组件
- `Slider_component.dart`: 滑块控制组件
- `Log_component.dart`: 日志显示组件
- `background_component.dart`: 背景样式组件
- `resource_label_component.dart`: 资源标签组件

### 控制器 (controllers/)
控制器处理业务逻辑并连接视图与模型/服务：
- `function_controller.dart`: 功能控制器，连接功能UI和FunctionModel，管理卡片数据
- `login_controller.dart`: 处理登录逻辑，使用ServerService通信
- `register_controller.dart`: 处理注册逻辑，使用Provider获取和更新LoginModel和GameModel
- `header_controller.dart`: 管理应用头部导航栏和游戏选择
- `aim_controller.dart`: 管理瞄准设置，使用AimModel存储数据
- `fov_controller.dart`: 视野设置控制器
- `pid_controller.dart`: PID控制器
- `fire_controller.dart`: 开火控制器
- `data_collection_controller.dart`: 数据采集控制器
- `side_controller.dart`: 侧边栏控制器
- `home_controller.dart`: 主页控制器

### 工具 (utils/)
- `blwebsocket.dart`: WebSocket连接工具，处理连接生命周期和消息传递
- `logger.dart`: 日志记录工具，提供不同级别的日志输出

### 视图 (views/)
包含所有应用程序的页面和屏幕：
- `function/function_screen.dart`: 功能配置页面，使用Provider获取FunctionController
- `function/card_manager_component.dart`: 卡片管理组件，管理功能卡片UI
- `login_screen.dart`: 登录页面，使用Provider获取服务
- `register_screen.dart`: 注册页面，使用RegisterController处理注册逻辑
- `header_screen.dart`: 头部导航页面，显示游戏选择和连接状态
- `aim_screen.dart`: 瞄准设置页面
- `fov_screen.dart`: 视野设置页面
- `fire_screen.dart`: 开火设置页面
- `pid_screen.dart`: PID设置页面
- `data_collection_screen.dart`: 数据采集页面
- `side_screen.dart`: 侧边栏页面
- `layout_screen.dart`: 布局设置页面
- `home_screen.dart`: 主页

## 状态管理方案

项目采用Provider作为状态管理解决方案：
1. 所有模型和服务均在`main.dart`中以Provider方式注册
2. 视图通过Context获取服务和模型，避免使用全局变量
3. 多级状态更新通过ChangeNotifier机制实现
4. 使用ChangeNotifierProxyProvider实现依赖模型之间的联动更新

## 项目架构模式

项目采用MVVM架构模式：
1. Model (模型层): 位于models/目录，如AimModel、FunctionModel等，负责数据存储和业务规则
2. ViewModel (控制器层): 位于controllers/目录，如AimController、FunctionController等，处理业务逻辑
3. View (视图层): 位于views/目录，如aim_screen.dart、function_screen.dart等，负责UI渲染
4. Service (服务层): 位于services/目录，提供外部系统接入

## 应用流程

1. 应用启动后先检查登录状态
2. 如果已登录且登录状态有效，则直接进入主界面
3. 否则导航到登录页面
4. 登录成功后，用户可以访问应用的各个功能页面

## 依赖注入结构

项目在main.dart中采用了多层依赖注入结构：
1. 核心服务注册：SharedPreferences
2. 基础服务注册：ServerService、AuthService
3. 数据模型注册：各种Model类
4. 控制器注册：使用ChangeNotifierProxyProvider进行依赖注入
   - 控制器依赖于服务和模型，通过Provider获取

## 文件规模分析

项目中规模较大的文件（按行数）：
1. Animation_component.dart (998行)
2. register_controller.dart (697行)
3. Log_component.dart (657行)
4. header_screen.dart (655行)
5. server_service.dart (646行)
6. function_controller.dart (638行)

代码量较大的模块：
1. 控制器模块：共11个文件，平均约485行/文件
2. 组件模块：共11个文件，平均约493行/文件
3. 模型模块：共15个文件，平均约168行/文件 